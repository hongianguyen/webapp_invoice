<script>
    // 1. DEFINE YOUR VARIABLES AND FUNCTIONS FIRST
    const CLIENT_ID = '725359001871-8p81bekdai3rdpn5igsr291d4p6hn0jt.apps.googleusercontent.com';
    const FOLDER_ID = '1IJ4wTZMfNn9MleyDudu13B2OjE9HvKcC';
    const SCOPES = 'https://www.googleapis.com/auth/drive.file';

    let tokenClient;
    let accessToken = null;

    // This function MUST be defined before the Google script loads
    function gisLoaded() {
        console.log("Library loaded successfully!");
        tokenClient = google.accounts.oauth2.initTokenClient({
            client_id: CLIENT_ID,
            scope: SCOPES,
            callback: (tokenResponse) => {
                accessToken = tokenResponse.access_token;
                document.getElementById('auth_btn').classList.add('hidden');
                document.getElementById('camera_section').classList.remove('hidden');
                startCamera();
            },
        });
    }

    document.getElementById('auth_btn').onclick = () => {
        if (tokenClient) {
            tokenClient.requestAccessToken();
        } else {
            alert("Google library not loaded yet. Please wait a moment.");
        }
    };

    // ... (Keep your startCamera, SNAP, and UPLOAD logic here) ...
</script>

<script src="https://accounts.google.com/gsi/client" onload="gisLoaded()"></script>

</body>
</html>
