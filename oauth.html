<!DOCTYPE html>
<html>
<head>
  <title>Authenticating...</title>
  <style>
    body {
      margin: 0;
      min-height: 100vh;
      background: #0a0a0f;
      color: #7a7a85;
      font-family: sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
    }
  </style>
</head>
<body>
  <p>Authenticating… you can close this window.</p>
  <script>
    // Extract the access_token from the URL hash that Google appended
    const params = new URLSearchParams(window.location.hash.replace('#', ''));
    const token  = params.get('access_token');

    if (token && window.opener) {
      // ── Popup flow: post the token back to the parent window ──
      window.opener.postMessage({ access_token: token }, window.opener.location.origin);
      window.close();
    } else if (token) {
      // ── Redirect flow (popup was blocked): redirect back to index.html with the token ──
      const base = window.location.origin + window.location.pathname.replace('oauth.html', '');
      window.location.href = base + '#' + window.location.hash.replace('#', '');
    } else {
      // No token — something went wrong
      document.querySelector('p').textContent = 'Authentication failed. Please close this window and try again.';
    }
  </script>
</body>
</html>
